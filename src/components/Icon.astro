---
// Import SVGs from pixelarticons package using Vite's glob
// This works with Cloudflare because Vite bundles them at build time
const iconModules = import.meta.glob('/node_modules/pixelarticons/svg/*.svg', { 
  eager: true,
  query: '?raw',
  import: 'default'
});

// Create a map of icon names to their SVG content
const iconMap: Record<string, string> = {};
for (const path in iconModules) {
  // Extract icon name from path like "/node_modules/pixelarticons/svg/menu.svg"
  const iconName = path.replace(/^.*\//, '').replace(/\.svg.*$/, '');
  const moduleContent = iconModules[path];
  const svgContent = typeof moduleContent === 'string' ? moduleContent : '';
  if (svgContent) {
    iconMap[iconName] = svgContent;
  }
}

interface Props {
  name: string;
  size?: number | string;
  class?: string;
}

const { name, size = 24, class: className = "" } = Astro.props;

// Ensure the icon name doesn't have path or extension
const iconName = name.replace(/\.svg$/, "").replace(/^.*\//, "");

// Get the SVG content from the map
const iconSvg: string | null = iconMap[iconName] || null;
---

{iconSvg ? (
  <span 
    class={`icon icon-${iconName} ${className}`}
    style={size ? `width: ${typeof size === 'number' ? `${size}px` : size}; height: ${typeof size === 'number' ? `${size}px` : size};` : undefined}
    set:html={iconSvg}
  />
) : (
  <span 
    class={`icon icon-${iconName} icon-error ${className}`}
    style={size ? `width: ${typeof size === 'number' ? `${size}px` : size}; height: ${typeof size === 'number' ? `${size}px` : size};` : undefined}
    title={`Icon "${name}" not found`}
  >
    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <rect x="2" y="2" width="20" height="20" stroke="currentColor" stroke-width="2"/>
      <line x1="12" y1="8" x2="12" y2="16" stroke="currentColor" stroke-width="2"/>
      <line x1="8" y1="12" x2="16" y2="12" stroke="currentColor" stroke-width="2"/>
    </svg>
  </span>
)}

<style>
  .icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    width: 24px;
    height: 24px;
    color: currentColor;
  }

  .icon :global(svg) {
    width: 100%;
    height: 100%;
    display: block;
  }

  .icon-error {
    opacity: 0.5;
  }
</style>
