---
import Icon from './Icon.astro';

interface Props {
  type?: "Field" | "Area" | "Dropdown";
  state?: "Empty" | "Filled" | "Error";
  label?: string;
  placeholder?: string;
  value?: string;
  errorMessage?: string;
  mandatoryField?: boolean;
  optionalHint?: boolean;
  focusRing?: boolean;
  name?: string;
  id?: string;
  className?: string;
}

const { 
  type = "Field",
  state = "Empty",
  label = "Label",
  placeholder,
  value,
  errorMessage = "This field cannot be empty",
  mandatoryField = false,
  optionalHint = true,
  focusRing = false,
  name,
  id,
  className = ""
} = Astro.props;

const isError = state === "Error";
const isArea = type === "Area";
const isDropdown = type === "Dropdown";
const isFilled = state === "Filled";

const borderColor = isError 
  ? "var(--color-accent-600)" 
  : "var(--color-primary-600)";
const bgColor = isError 
  ? "var(--color-accent-50)" 
  : (isFilled ? "var(--color-primary-50)" : "var(--color-neutral-0)");
const textColor = isError
  ? "var(--color-accent-600)"
  : (isFilled ? "var(--color-primary-900)" : "var(--color-neutral-300)");
const labelColor = isError
  ? "var(--color-accent-900)"
  : "var(--color-primary-900)";
const chevronColor = isError
  ? "var(--color-accent-600)"
  : "var(--color-primary-900)";
---

<div class={`input-field input-${type} input-${state} ${className}`}>
  <div class="label-group">
    {mandatoryField && (
      <span class="mandatory-indicator">*</span>
    )}
    <label for={id} class="label" style:color={labelColor}>
      {label}
    </label>
  </div>
  {isArea ? (
    <textarea
      id={id}
      name={name}
      class={`input input-area ${isError ? "input-error" : ""}`}
      placeholder={optionalHint ? placeholder : undefined}
      value={value}
      rows={4}
      style:border-color={borderColor}
      style:background-color={bgColor}
      style:color={isError ? textColor : (isFilled ? "var(--color-primary-900)" : "var(--color-text)")}
    ></textarea>
  ) : isDropdown ? (
    <div class={`dropdown-wrapper ${isError ? "dropdown-error" : ""}`} style:border-color={borderColor} style:background-color={bgColor}>
      <select
        id={id}
        name={name}
        class={`input input-dropdown ${isError ? "input-error" : ""}`}
        style:color={textColor}
      >
        {optionalHint && !value && (
          <option value="" disabled selected>{placeholder || "Select an option"}</option>
        )}
        <slot />
      </select>
      <div class="dropdown-icon-wrapper">
        <Icon name="chevron-down" size={24} style:color={chevronColor} />
      </div>
      {focusRing && (
        <span 
          class="focus-ring"
          style:border-color={isError ? "var(--color-accent-300)" : "var(--color-primary-300)"}
        ></span>
      )}
    </div>
  ) : (
    <input
      type="text"
      id={id}
      name={name}
      class={`input input-field ${isError ? "input-error" : ""}`}
      placeholder={optionalHint ? placeholder : undefined}
      value={value}
      style:border-color={borderColor}
      style:background-color={bgColor}
      style:color={isError ? textColor : (isFilled ? "var(--color-primary-900)" : "var(--color-text)")}
    />
  )}
  {!isDropdown && focusRing && (
    <span 
      class="focus-ring"
      style:border-color={isError ? "var(--color-accent-300)" : "var(--color-primary-300)"}
    ></span>
  )}
  {isError && errorMessage && (
    <p class="error-message">{errorMessage}</p>
  )}
</div>

<style>
  .input-field {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-core-600-md);
    width: 100%;
    min-width: 0;
    box-sizing: border-box;
  }

  .label-group {
    display: flex;
    gap: var(--spacing-core-300-md);
    align-items: center;
    font: var(--typography-body-lg);
    color: var(--color-primary-900);
  }

  .mandatory-indicator {
    color: var(--color-accent-600);
  }

  .label {
    font: var(--typography-body-lg);
    color: var(--color-primary-900);
  }

  .input {
    width: 100%;
    min-height: 60px;
    padding: var(--spacing-core-700-md);
    border: var(--border-width-default) solid;
    background-color: var(--color-neutral-0);
    font: var(--typography-body-md);
    color: var(--color-text);
    outline: none;
    box-sizing: border-box;
  }

  .input::placeholder {
    color: var(--color-neutral-300);
  }

  .input-area {
    min-height: 136px;
    resize: vertical;
    font-family: inherit;
  }

  .dropdown-wrapper {
    position: relative;
    width: 100%;
    height: 60px;
    min-height: 60px;
    max-height: 60px;
    padding: var(--spacing-core-700-md);
    border: var(--border-width-default) solid;
    cursor: pointer;
    box-sizing: border-box;
    overflow: hidden;
    border-top-width: var(--border-width-default);
    border-right-width: var(--border-width-default);
    border-bottom-width: var(--border-width-default);
    border-left-width: var(--border-width-default);
  }

  .dropdown-wrapper.dropdown-error {
    border-top: var(--border-width-default) solid var(--color-accent-600) !important;
    border-right: var(--border-width-default) solid var(--color-accent-600) !important;
    border-bottom: var(--border-width-default) solid var(--color-accent-600) !important;
    border-left: var(--border-width-default) solid var(--color-accent-600) !important;
  }

  .input-dropdown {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    height: 100%;
    max-height: 100%;
    cursor: pointer;
    border: none;
    background: transparent;
    padding: 0 var(--spacing-core-700-md);
    padding-right: calc(var(--spacing-core-700-md) + 24px + var(--spacing-core-600-md));
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    outline: none;
    font: var(--typography-body-md);
    line-height: calc(60px - 2 * var(--border-width-default) - 2 * var(--spacing-core-700-md));
    z-index: 1;
    vertical-align: middle;
  }

  .input-dropdown::-ms-expand {
    display: none;
  }

  .input-dropdown option {
    color: var(--color-primary-900);
    background-color: var(--color-neutral-0);
  }

  .dropdown-icon-wrapper {
    position: absolute;
    right: var(--spacing-core-700-md);
    top: 50%;
    transform: translateY(-50%);
    z-index: 2;
    pointer-events: none;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
  }

  .input-error {
    background-color: var(--color-accent-50);
    border-color: var(--color-accent-600);
    color: var(--color-accent-600);
  }

  .input-error::placeholder {
    color: var(--color-accent-600);
  }

  .focus-ring {
    position: absolute;
    inset: -1px;
    border: var(--spacing-core-300-md) solid;
    pointer-events: none;
  }

  .error-message {
    font: var(--typography-body-md);
    font-weight: var(--font-weight-bold);
    color: var(--color-accent-600);
    margin: 0;
  }

  .input:focus {
    outline: none;
  }

  .input:focus-visible {
    outline: 2px solid var(--color-primary-600);
    outline-offset: 2px;
  }
</style>
